<div class="min-h-screen bg-gray-50 dark:bg-gray-900 pt-32 pb-12 font-sans text-gray-900 dark:text-gray-100">
  <div class="container mx-auto px-4 max-w-7xl">
    
    <!-- Loading State -->
    <div *ngIf="isLoading && !hasError" class="flex flex-col items-center justify-center py-20">
      <div class="w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-4"></div>
      <p class="text-gray-500 dark:text-gray-400 font-medium">Loading product details...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError && !isLoading" class="max-w-2xl mx-auto text-center py-20">
      <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-red-100 text-red-600 mb-6">
        <svg *ngIf="errorType === 'not-found'" class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="m9 9 6 6"></path><path d="m15 9-6 6"></path></svg>
        <svg *ngIf="errorType === 'server-error'" class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
        <svg *ngIf="errorType === 'network-error'" class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 19c-5 0-8-3-8-8s3-8 8-8 8 3 8 8-3 8-8 8"></path><path d="m8 11 2 2 4-4"></path></svg>
      </div>

      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">
        <span *ngIf="errorType === 'not-found'">Product Not Found</span>
        <span *ngIf="errorType === 'server-error'">Server Error</span>
        <span *ngIf="errorType === 'network-error'">Connection Error</span>
      </h1>

      <p class="text-gray-600 dark:text-gray-400 mb-8 text-lg">{{ errorMessage }}</p>

      <div class="flex flex-wrap justify-center gap-4">
        <button *ngIf="errorType !== 'not-found'" (click)="retryLoadProduct()" class="px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/30 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="23,4 23,10 17,10"></polyline><polyline points="1,20 1,14 7,14"></polyline><path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path></svg>
          Try Again
        </button>

        <button (click)="goHome()" class="px-6 py-3 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9,22 9,12 15,12 15,22"></polyline></svg>
          Go Home
        </button>

        <button (click)="goToProducts()" class="px-6 py-3 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
          Browse Products
        </button>
      </div>
    </div>

    <!-- Product Detail Content -->
    <div *ngIf="product && !hasError && !isLoading" class="animate-fade-in">
      <!-- Breadcrumb -->
      <nav class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-8" aria-label="Breadcrumb">
        <a routerLink="/products" class="hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors">Products</a>
        <span class="mx-2 text-gray-300 dark:text-gray-600">/</span>
        <span class="text-gray-900 dark:text-white font-medium truncate max-w-xs">{{ product.name }}</span>
      </nav>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-16">
        <!-- Product Gallery -->
        <div class="space-y-6">
          <div class="aspect-square bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-sm border border-gray-100 dark:border-gray-700 relative group">
            <img
              [src]="selectedImage"
              [alt]="product.name"
              class="w-full h-full object-contain p-8 transition-transform duration-500 group-hover:scale-105"
              (error)="onImageError($event)"
            />
            <div class="absolute bottom-4 right-4 bg-black/50 backdrop-blur-sm text-white text-xs px-3 py-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none flex items-center gap-1">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
              Hover to zoom
            </div>
          </div>

          <!-- Thumbnail Gallery -->
          <div class="flex gap-4 overflow-x-auto pb-2 scrollbar-hide" *ngIf="product.images && product.images.length > 1">
            <button
              *ngFor="let image of product.images; let i = index"
              class="flex-shrink-0 w-20 h-20 rounded-lg border-2 overflow-hidden transition-all"
              [class.border-indigo-600]="selectedImage === image.imageUrl"
              [class.border-transparent]="selectedImage !== image.imageUrl"
              [class.opacity-60]="selectedImage !== image.imageUrl"
              [class.hover:opacity-100]="selectedImage !== image.imageUrl"
              (click)="selectImage(image.imageUrl)"
            >
              <img
                [src]="image.imageUrl"
                [alt]="'Product image ' + (i + 1)"
                class="w-full h-full object-cover bg-white"
                (error)="onImageError($event)"
              />
            </button>
          </div>
        </div>

        <!-- Product Info -->
        <div class="flex flex-col">
          <div class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4 leading-tight">{{ product.name }}</h1>
            <div class="flex items-center gap-4">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium" 
                [ngClass]="getQuantityAsNumber(product.quantity) > 0 ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' : 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400'">
                <span class="w-2 h-2 rounded-full mr-2" [ngClass]="getQuantityAsNumber(product.quantity) > 0 ? 'bg-green-500' : 'bg-red-500'"></span>
                {{ getQuantityAsNumber(product.quantity) > 0 ? 'In Stock' : 'Out of Stock' }}
              </span>
              <div class="flex items-center text-yellow-400">
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <svg class="w-5 h-5 text-gray-300 dark:text-gray-600" fill="currentColor" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <span class="ml-2 text-sm text-gray-500 dark:text-gray-400">(28 reviews)</span>
              </div>
            </div>
          </div>

          <div class="mb-8 pb-8 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-baseline gap-2">
              <span class="text-4xl font-bold text-gray-900 dark:text-white">{{ formatPrice(product.price) }}</span>
              <span class="text-lg text-gray-500 dark:text-gray-400 font-medium">XOF</span>
            </div>
          </div>

          <div class="prose dark:prose-invert max-w-none mb-8 text-gray-600 dark:text-gray-300 leading-relaxed">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Description</h3>
            <p>{{ product.description }}</p>
          </div>

          <div class="bg-gray-50 dark:bg-gray-800/50 rounded-xl p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider mb-4">Product Details</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
              <div class="flex justify-between py-2 border-b border-gray-200 dark:border-gray-700 last:border-0">
                <span class="text-gray-500 dark:text-gray-400">Availability</span>
                <span class="font-medium text-gray-900 dark:text-white">{{ getQuantityAsNumber(product.quantity) }} units</span>
              </div>
              <div class="flex justify-between py-2 border-b border-gray-200 dark:border-gray-700 last:border-0">
                <span class="text-gray-500 dark:text-gray-400">Category</span>
                <span class="font-medium text-gray-900 dark:text-white">General</span>
              </div>
            </div>
          </div>

          <!-- Seller Info -->
          <div *ngIf="seller && !isGuest" class="bg-gray-50 dark:bg-gray-800/50 rounded-xl p-6 mb-8 border border-gray-100 dark:border-gray-700 flex items-center gap-4">
            <img [src]="seller.avatar || 'https://ui-avatars.com/api/?name=' + seller.name" alt="{{seller.name}}" class="w-16 h-16 rounded-full object-cover border-2 border-indigo-100 dark:border-indigo-900">
            <div>
              <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1">Sold by</h3>
              <p class="font-bold text-gray-900 dark:text-white text-lg">{{ seller.name }}</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">{{ seller.email }}</p>
            </div>
          </div>

          <div class="mt-auto space-y-6">
            <!-- Quantity Selector -->
            <div class="flex items-center gap-4" *ngIf="getQuantityAsNumber(product.quantity) > 0">
              <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Quantity</label>
              <div class="flex items-center border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800">
                <button (click)="decreaseQuantity()" [disabled]="selectedQuantity <= 1" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 disabled:opacity-50 transition-colors rounded-l-lg">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </button>
                <span class="w-12 text-center font-medium text-gray-900 dark:text-white">{{ selectedQuantity }}</span>
                <button (click)="increaseQuantity()" [disabled]="selectedQuantity >= getQuantityAsNumber(product.quantity)" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 disabled:opacity-50 transition-colors rounded-r-lg">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </button>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4">
              <button
                class="flex-1 px-8 py-4 bg-indigo-600 text-white rounded-xl font-bold text-lg shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 hover:shadow-indigo-500/50 hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0 disabled:shadow-none flex items-center justify-center gap-2"
                [disabled]="getQuantityAsNumber(product.quantity) === 0 || isGuest"
                (click)="addToCart()"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="8" cy="21" r="1"></circle><circle cx="19" cy="21" r="1"></circle><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path></svg>
                {{ getQuantityAsNumber(product.quantity) === 0 ? 'Out of Stock' : 'Add to Cart' }}
              </button>

              <button class="px-4 py-4 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center justify-center gap-2" (click)="addToWishlist()">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
              </button>

              <button class="px-4 py-4 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center justify-center gap-2" (click)="shareProduct()">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16,6 12,2 8,6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>
              </button>
            </div>

            <!-- Guest Notice -->
            <div *ngIf="isGuest" class="bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 p-4 rounded-lg text-sm flex items-center gap-3">
              <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
              <p>Please <a routerLink="/auth" class="font-semibold underline hover:text-blue-800 dark:hover:text-blue-200">sign in</a> to add items to your cart.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Related Products -->
      <div class="mb-16" *ngIf="relatedProducts && relatedProducts.length > 0">
        <div class="flex justify-between items-end mb-8">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white">You Might Also Like</h2>
          <a routerLink="/products" class="text-indigo-600 dark:text-indigo-400 font-medium hover:text-indigo-700 dark:hover:text-indigo-300 flex items-center gap-1">
            View All <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"></path></svg>
          </a>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
          <div *ngFor="let relatedProduct of relatedProducts" class="group bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 overflow-hidden hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
            <a [routerLink]="['/products', relatedProduct.id]" class="block h-full">
              <div class="aspect-[4/3] bg-gray-50 dark:bg-gray-900/50 p-4 flex items-center justify-center relative overflow-hidden">
                <img
                  [src]="getProductImage(relatedProduct)"
                  [alt]="relatedProduct.name"
                  class="w-full h-full object-contain transition-transform duration-500 group-hover:scale-110"
                  (error)="onImageError($event)"
                />
              </div>
              <div class="p-4">
                <h4 class="text-gray-900 dark:text-white font-medium line-clamp-2 mb-2 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">{{ relatedProduct.name }}</h4>
                <div class="flex items-baseline gap-1">
                  <span class="text-lg font-bold text-gray-900 dark:text-white">{{ formatPrice(relatedProduct.price) }}</span>
                  <span class="text-xs text-gray-500 dark:text-gray-400">XOF</span>
                </div>
              </div>
            </a>
          </div>
        </div>
      </div>

      <!-- Reviews Placeholder -->
      <div class="bg-gray-50 dark:bg-gray-800/50 rounded-2xl p-8 md:p-12 text-center border border-gray-100 dark:border-gray-700">
        <div class="w-16 h-16 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-full flex items-center justify-center mx-auto mb-6">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-3">Customer Reviews</h2>
        <p class="text-gray-600 dark:text-gray-400 max-w-md mx-auto mb-8">
          Customer reviews and ratings will be available soon. Be the first to share your experience with this product!
        </p>
        <button class="px-6 py-2 bg-white dark:bg-gray-800 text-gray-400 border border-gray-200 dark:border-gray-700 rounded-lg font-medium cursor-not-allowed">
          Write a Review
        </button>
      </div>
    </div>
  </div>
</div>